---
const { travel } = Astro.props;
const coverImage = travel.data.coverImage;
---

<div class="travel-journey">
  <!-- 移动端首页背景图 -->
  <div id="mobileBg" class="fixed inset-0 z-0 hidden bg-cover bg-center" style={`background-image: url(${coverImage})`}></div>

  <!-- Bento Grid 布局 -->
  <div id="mainContent" class="h-screen w-screen gap-6 bg-transparent p-6">
    <!-- 左侧卡片 -->
    <div id="leftCard" class="glass-effect rounded-bento shadow-bento scrollbar-hide relative z-10 h-full w-3/5 overflow-y-auto transition-all duration-500 ease-out">
      <div id="contentArea" class="content-area h-full w-full p-14 pt-20 transition-all duration-400 ease-out"></div>

      <!-- 照片查看模式 -->
      <div id="photoViewMode" class="rounded-bento invisible absolute left-0 top-0 z-50 h-full w-full flex flex-col bg-white/98 backdrop-blur-2xl opacity-0 transition-all duration-300 ease-out">
        <div class="relative flex flex-1 items-center justify-center overflow-hidden p-6">
          <img src="" alt="" id="photoViewImg" class="shadow-bento-hover max-h-full max-w-full rounded-bento-sm object-contain transition-all duration-500" />
          <!-- 关闭按钮 - 右上角 -->
          <div id="closePhotoBtn" class="pointer-events-auto absolute right-4 top-4 z-10 h-9 w-9 flex cursor-pointer items-center justify-center rounded-full bg-slate-100/80 backdrop-blur-sm transition-all duration-300 hover:bg-accent hover:scale-105 group">
            <svg class="h-4 w-4 text-slate-500 transition-colors group-hover:text-white" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path>
            </svg>
          </div>
        </div>
        <!-- 底部信息栏 -->
        <div class="bg-white/90 backdrop-blur-sm border-t border-slate-100 px-6 py-4">
          <div class="flex flex-col items-center gap-3">
            <!-- 照片描述 -->
            <div id="photoViewCaption" class="text-sm text-slate-600 leading-relaxed font-light text-center max-w-lg"></div>
            <!-- 照片导航 -->
            <div class="flex items-center gap-1 p-1 rounded-full bg-slate-50">
              <div id="prevPhotoBtn" class="pointer-events-auto h-8 w-8 flex cursor-pointer items-center justify-center rounded-full transition-all duration-300 hover:bg-white hover:shadow-soft group">
                <svg class="h-4 w-4 text-slate-400 transition-all duration-300 group-hover:text-primary group-hover:-translate-x-0.5" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                </svg>
              </div>
              <div id="photoCounter" class="px-3 text-xs text-slate-400 tabular-nums">
                <span id="currentPhotoNum">1</span> / <span id="totalPhotoNum">1</span>
              </div>
              <div id="nextPhotoBtn" class="pointer-events-auto h-8 w-8 flex cursor-pointer items-center justify-center rounded-full transition-all duration-300 hover:bg-white hover:shadow-soft group">
                <svg class="h-4 w-4 text-slate-400 transition-all duration-300 group-hover:text-primary group-hover:translate-x-0.5" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path>
                </svg>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 右侧卡片 -->
    <div id="rightCard" class="rounded-bento shadow-bento relative h-full w-2/5 overflow-hidden transition-all duration-500 ease-out">
      <div class="map-container rounded-bento relative h-full w-full overflow-hidden" style="display: none;">
        <div id="map" class="rounded-bento z-[1] h-full w-full"></div>
      </div>
    </div>
  </div>


  <!-- 底部导航栏 -->
  <div id="bottomNav" class="fixed bottom-6 left-1/2 -translate-x-1/2 z-40 flex items-center gap-1 p-1.5 rounded-full bg-white/80 backdrop-blur-xl shadow-bento border border-white/50 transition-all duration-300">
    <div id="prevBtn" class="h-10 w-10 flex cursor-pointer items-center justify-center rounded-full transition-all duration-300 hover:bg-slate-100 group">
      <svg class="h-4 w-4 text-primary/60 transition-all duration-300 group-hover:text-primary group-hover:-translate-x-0.5" viewBox="0 0 24 24" fill="currentColor">
        <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
      </svg>
    </div>
    <div id="pageIndicator" class="flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-slate-50/80">
      <span id="currentPage" class="text-sm font-semibold text-primary tabular-nums">1</span>
      <span class="text-slate-300 text-xs">/</span>
      <span id="totalPages" class="text-sm text-slate-400 tabular-nums">1</span>
    </div>
    <div id="nextBtn" class="h-10 w-10 flex cursor-pointer items-center justify-center rounded-full transition-all duration-300 hover:bg-slate-100 group">
      <svg class="h-4 w-4 text-primary/60 transition-all duration-300 group-hover:text-primary group-hover:translate-x-0.5" viewBox="0 0 24 24" fill="currentColor">
        <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path>
      </svg>
    </div>
  </div>

  <script is:inline define:vars={{ travelData: travel.data }}>
// 检测移动设备 (pad 及以下，1024px)
function isMobileDevice() {
  return window.innerWidth < 1024
}

// 处理移动/桌面布局切换
function handleLayoutSwitch() {
  const isMobile = isMobileDevice()
  const mobileBg = document.getElementById('mobileBg')
  const leftCard = document.getElementById('leftCard')
  const rightCard = document.getElementById('rightCard')
  const mainContent = document.getElementById('mainContent')
  
  if (isMobile) {
    // 移动端布局
    mainContent.classList.add('mobile-layout')
    mainContent.classList.remove('flex')
    leftCard.classList.add('mobile-card')
    rightCard.classList.add('hidden')
    // 首页时显示背景图
    if (currentSection === 0) {
      mobileBg.classList.remove('hidden')
      leftCard.classList.add('mobile-cover-card')
    }
  } else {
    // 桌面端布局
    mobileBg.classList.add('hidden')
    mainContent.classList.remove('mobile-layout')
    mainContent.classList.add('flex')
    leftCard.classList.remove('mobile-card', 'mobile-cover-card')
    rightCard.classList.remove('hidden')
  }
  
  return isMobile
}


// 全局变量
let currentSection = 0
const totalSections = travelData.days.length + 1
let map, markers = [], currentPhotoItems = [], currentPhotoIndex = 0
let isMobile = false
let mapInitialized = false

// 初始化
function init() {
  isMobile = handleLayoutSwitch()
  
  // 更新页面指示器
  document.getElementById('totalPages').textContent = totalSections
  
  // 仅在桌面端初始化地图
  if (!isMobile) {
    initMap()
    mapInitialized = true
  }
  
  loadSection(0)
  
  document.getElementById('prevBtn').addEventListener('click', navigatePrev)
  document.getElementById('nextBtn').addEventListener('click', navigateNext)
  
  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowRight' || e.key === 'ArrowDown') navigateNext()
    else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') navigatePrev()
    else if (e.key === 'Escape' && document.getElementById('photoViewMode').classList.contains('active')) closePhotoView()
  })
  
  document.getElementById('prevPhotoBtn').addEventListener('click', navigatePhotoPrev)
  document.getElementById('nextPhotoBtn').addEventListener('click', navigatePhotoNext)
  document.getElementById('closePhotoBtn').addEventListener('click', closePhotoView)
  
  // 触摸导航 - 水平滑动
  let touchStartX = 0
  let touchStartY = 0
  document.addEventListener('touchstart', (e) => { 
    touchStartX = e.touches[0].clientX
    touchStartY = e.touches[0].clientY 
  })
  document.addEventListener('touchend', (e) => {
    const diffX = touchStartX - e.changedTouches[0].clientX
    const diffY = touchStartY - e.changedTouches[0].clientY
    
    // 优先检测水平滑动（移动端更自然）
    if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
      diffX > 0 ? navigateNext() : navigatePrev()
    } else if (!isMobile && Math.abs(diffY) > 50) {
      // 桌面端保留垂直滑动
      diffY > 0 ? navigateNext() : navigatePrev()
    }
  })
  
  updateNavButtons()
}

// 初始化地图
function initMap() {
  if (isMobile || mapInitialized) return
  
  map = L.map('map', { zoomControl: false, preferCanvas: true, renderer: L.canvas() })
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
  }).addTo(map)
  L.control.zoom({ position: 'bottomright' }).addTo(map)
  map.setView([35.0116, 135.7681], 12, { animate: false })
  mapInitialized = true
}


// 加载指定部分
function loadSection(index) {
  const contentArea = document.getElementById('contentArea')
  const container = document.querySelector('.flex.w-screen.h-screen, .mobile-layout')
  const mapContainer = document.querySelector('.map-container')
  const leftCard = document.getElementById('leftCard')
  const rightCard = document.getElementById('rightCard')
  const mobileBg = document.getElementById('mobileBg')
  const isTravelToTravel = index > 0 && currentSection > 0

  const animateTransition = async () => {
    leftCard.classList.add('card-exit')
    if (!isMobile && !isTravelToTravel) {
      rightCard.classList.add('card-exit')
      if (currentSection > 0) mapContainer.style.opacity = '0'
    }
    contentArea.classList.add('fade-out')

    await new Promise(r => setTimeout(r, 250))
    contentArea.innerHTML = ''

    if (!isMobile && isTravelToTravel) {
      clearMarkers()
      addDayMarkers(index - 1)
      if (markers.length > 0) {
        map.flyToBounds(L.featureGroup(markers).getBounds().pad(0.1), { duration: 1.2, easeLinearity: 0.2, animate: true })
      }
    } else if (!isMobile) {
      clearMarkers()
    }

    if (index === 0) {
      loadCover()
      if (container) container.classList.add('cover-mode')
      if (isMobile) {
        // 移动端首页：显示背景图，卡片透明
        mobileBg.classList.remove('hidden')
        leftCard.classList.add('mobile-cover-card')
      } else {
        const rightPanel = document.getElementById('rightCard')
        rightPanel.style.backgroundImage = `url(${travelData.coverImage})`
        rightPanel.style.backgroundSize = 'cover'
        rightPanel.style.backgroundPosition = 'center'
        rightPanel.style.transition = 'transform 12s ease-out'
        mapContainer.style.display = 'none'
      }
    } else {
      if (container) container.classList.remove('cover-mode')
      if (isMobile) {
        // 移动端非首页：隐藏背景图，卡片不透明
        mobileBg.classList.add('hidden')
        leftCard.classList.remove('mobile-cover-card')
      } else {
        const rightPanel = document.getElementById('rightCard')
        rightPanel.style.backgroundImage = ''
        rightPanel.style.transform = ''
      }
      loadDay(index - 1, index !== 1 || isTravelToTravel)
      if (!isMobile && !isTravelToTravel) {
        mapContainer.style.display = 'block'
        mapContainer.style.opacity = '0'
        addDayMarkers(index - 1)
        if (markers.length > 0) {
          map.invalidateSize()
          map.fitBounds(L.featureGroup(markers).getBounds().pad(0.1), { animate: false })
        }
      }
    }

    currentSection = index
    document.getElementById('currentPage').textContent = index + 1
    updateNavButtons()

    if (!isMobile && !isTravelToTravel) {
      leftCard.classList.add('card-enter-left')
      rightCard.classList.add('card-enter-right')
    }

    await new Promise(r => setTimeout(r, 50))
    leftCard.classList.remove('card-exit', 'card-enter-left')
    if (!isMobile && !isTravelToTravel) rightCard.classList.remove('card-exit', 'card-enter-right')
    contentArea.classList.remove('fade-out')
    contentArea.classList.add('fade-in')

    await new Promise(r => setTimeout(r, 400))
    contentArea.classList.remove('fade-in')

    if (!isMobile && index > 0 && !isTravelToTravel) {
      map.invalidateSize()
      mapContainer.style.transition = 'opacity 0.4s ease-out'
      mapContainer.style.opacity = '1'
    }
  }

  animateTransition()
}


// 加载封面
function loadCover() {
  const contentArea = document.getElementById('contentArea')
  const mobileClass = isMobile ? 'mobile-cover' : ''
  contentArea.innerHTML = `
    <div class="flex flex-col justify-center h-full ${mobileClass}">
      <div class="mb-6">
        <span class="inline-block px-3 py-1 text-xs font-medium tracking-wider uppercase text-accent bg-accent/10 rounded-full">旅行日记</span>
      </div>
      <h1 class="font-snell text-5xl md:text-6xl lg:text-7xl font-bold mb-4 text-primary leading-[1.1] tracking-tight mobile-title">${travelData.title}</h1>
      <h2 class="font-cormorant text-2xl md:text-3xl lg:text-4xl font-medium mb-10 text-primary/70 tracking-tight mobile-subtitle">${travelData.subtitle}</h2>
      <p class="text-base text-light-text leading-relaxed max-w-lg font-light mobile-desc">${travelData.description}</p>
      <div class="mt-12 flex items-center gap-3 text-sm text-light-text">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
        <span>${travelData.totaldays !== undefined ? travelData.totaldays : travelData.days.length} 天行程</span>
      </div>
    </div>
  `
}

// 加载行程日
function loadDay(dayIndex, later = false) {
  const day = travelData.days[dayIndex]
  const contentArea = document.getElementById('contentArea')
  const dayNum = day.day !== undefined ? day.day : dayIndex
  const gridCols = isMobile ? 'grid-cols-2' : 'grid-cols-2 md:grid-cols-3'
  
  let descriptionsHTML = day.descriptions.map(desc => 
    `<p class="mb-5 text-light-text text-base leading-relaxed font-light">${desc}</p>`
  ).join('')

  contentArea.innerHTML = `
    <div class="h-full overflow-y-auto scrollbar-hide pb-8">
      <div class="mb-2">
        <span class="inline-block px-2.5 py-1 text-xs font-medium tracking-wider uppercase text-accent-soft bg-accent-soft/10 rounded-full">Day ${dayNum}</span>
      </div>
      <h3 class="font-cormorant text-3xl md:text-4xl lg:text-5xl font-semibold mb-8 text-primary tracking-tight leading-tight mobile-day-title">${day.title}</h3>
      ${descriptionsHTML}
      <div id="photos-container" class="grid ${gridCols} gap-4 mt-10">
        ${createPlaceholders(day.photos.length)}
      </div>
    </div>
  `

  setTimeout(() => {
    const loadPhotoBatch = (startIdx, batchSize) => {
      const endIdx = Math.min(startIdx + batchSize, day.photos.length)
      const placeholders = document.querySelectorAll('#photos-container > div')
      
      for (let i = startIdx; i < endIdx; i++) {
        if (i >= placeholders.length) break
        const photo = day.photos[i]
        const placeholder = placeholders[i]
        
        const photoElement = document.createElement('div')
        photoElement.className = 'relative aspect-[4/3] rounded-bento-sm overflow-hidden cursor-pointer transition-all duration-400 ease-out shadow-soft hover:shadow-bento-hover hover:-translate-y-1 group'
        photoElement.dataset.index = i.toString()
        photoElement.innerHTML = `
          <img src="${photo.src}" alt="${photo.alt}" class="w-full h-full object-cover transition-transform duration-500 ease-out group-hover:scale-105">
          <div class="absolute inset-0 bg-gradient-to-t from-black/40 via-transparent to-transparent opacity-0 transition-opacity duration-300 group-hover:opacity-100"></div>
          <div class="absolute bottom-3 left-3 right-3 text-white text-xs font-medium opacity-0 transition-all duration-300 translate-y-2 group-hover:opacity-100 group-hover:translate-y-0 truncate">${photo.alt}</div>
        `
        photoElement.addEventListener('click', () => openPhotoView(dayIndex, i))
        placeholder.parentNode.replaceChild(photoElement, placeholder)
      }
      
      if (endIdx < day.photos.length) setTimeout(() => loadPhotoBatch(endIdx, batchSize), 80)
    }
    loadPhotoBatch(0, 2)
  }, later ? 1400 : 250)
}


// 创建占位符
function createPlaceholders(count) {
  let html = ''
  for (let i = 0; i < count; i++) {
    html += `
      <div class="relative aspect-[4/3] rounded-bento-sm overflow-hidden bg-slate-100">
        <div class="absolute inset-0 bg-gradient-to-r from-slate-100 via-slate-50 to-slate-100 animate-shimmer" style="background-size: 200% 100%"></div>
      </div>
    `
  }
  return html
}

// 清除标记
function clearMarkers() {
  if (isMobile || !map) return
  markers.forEach(m => map.removeLayer(m))
  markers = []
}

// 添加标记
function addDayMarkers(dayIndex) {
  if (isMobile || !map) return
  const day = travelData.days[dayIndex]
  day.photos.forEach((photo, photoIndex) => {
    if (photo.lat && photo.lng) {
      const marker = L.marker([photo.lat, photo.lng], { title: photo.alt }).addTo(map)
      marker.bindPopup(`
        <div class="w-48 text-center p-1">
          <img src="${photo.src}" alt="${photo.alt}" class="w-full rounded-lg mb-2">
          <div class="font-medium text-sm">${photo.alt}</div>
        </div>
      `)
      marker.on('click', () => openPhotoView(dayIndex, photoIndex))
      markers.push(marker)
    }
  })
}

// 打开照片查看
function openPhotoView(dayIndex, photoIndex) {
  currentPhotoItems = travelData.days[dayIndex].photos
  currentPhotoIndex = photoIndex

  const bottomNav = document.getElementById('bottomNav')
  const contentArea = document.getElementById('contentArea')
  const photoViewMode = document.getElementById('photoViewMode')

  const animate = async () => {
    bottomNav.style.opacity = '0'
    bottomNav.style.visibility = 'hidden'
    contentArea.style.opacity = '0'
    contentArea.style.visibility = 'hidden'

    photoViewMode.classList.add('active')
    photoViewMode.classList.remove('invisible')
    photoViewMode.classList.add('visible')
    photoViewMode.style.opacity = '0'

    const img = new Image()
    await new Promise(r => { img.onload = r; img.src = currentPhotoItems[currentPhotoIndex].src })

    updatePhotoViewContent()
    await new Promise(r => setTimeout(r, 50))
    photoViewMode.style.opacity = '1'
    await new Promise(r => setTimeout(r, 100))
    updateMapView()
  }
  animate()
}


// 更新照片查看内容
function updatePhotoViewContent() {
  const photoViewImg = document.getElementById('photoViewImg')
  const photoViewCaption = document.getElementById('photoViewCaption')
  const prevPhotoBtn = document.getElementById('prevPhotoBtn')
  const nextPhotoBtn = document.getElementById('nextPhotoBtn')
  const currentPhotoNum = document.getElementById('currentPhotoNum')
  const totalPhotoNum = document.getElementById('totalPhotoNum')
  const currentPhoto = currentPhotoItems[currentPhotoIndex]

  photoViewImg.src = currentPhoto.src
  photoViewImg.alt = currentPhoto.alt
  
  // 更新照片计数器
  currentPhotoNum.textContent = currentPhotoIndex + 1
  totalPhotoNum.textContent = currentPhotoItems.length
  
  // 更新描述
  photoViewCaption.textContent = currentPhoto.caption || currentPhoto.alt || ''

  // 更新按钮状态
  const isFirst = currentPhotoIndex === 0
  const isLast = currentPhotoIndex === currentPhotoItems.length - 1
  
  prevPhotoBtn.classList.toggle('opacity-30', isFirst)
  prevPhotoBtn.classList.toggle('pointer-events-none', isFirst)
  nextPhotoBtn.classList.toggle('opacity-30', isLast)
  nextPhotoBtn.classList.toggle('pointer-events-none', isLast)
}

// 更新地图视图
function updateMapView() {
  if (isMobile || !map) return
  const currentPhoto = currentPhotoItems[currentPhotoIndex]
  if (currentPhoto.lat && currentPhoto.lng) {
    map.flyTo([currentPhoto.lat, currentPhoto.lng], 16, { duration: 1.2, easeLinearity: 0.2, animate: true })
    markers.forEach(m => {
      if (m.getLatLng().lat === currentPhoto.lat && m.getLatLng().lng === currentPhoto.lng) m.openPopup()
    })
  }
}

function updatePhotoView() {
  updatePhotoViewContent()
  setTimeout(updateMapView, 100)
}

// 关闭照片查看
function closePhotoView() {
  const photoViewMode = document.getElementById('photoViewMode')
  const animate = async () => {
    photoViewMode.style.opacity = '0'
    await new Promise(r => setTimeout(r, 250))
    
    photoViewMode.classList.remove('active', 'visible')
    photoViewMode.classList.add('invisible')
    
    const contentArea = document.getElementById('contentArea')
    contentArea.style.visibility = 'visible'
    contentArea.style.opacity = '1'
    
    // 清除内联样式，避免影响后续 CSS 类动画
    setTimeout(() => {
      contentArea.style.transition = ''
      contentArea.style.visibility = ''
      contentArea.style.opacity = ''
    }, 300)
    
    const bottomNav = document.getElementById('bottomNav')
    bottomNav.style.opacity = '1'
    bottomNav.style.visibility = 'visible'
    
    if (!isMobile && map) {
      markers.forEach(m => m.closePopup())
      
      await new Promise(r => setTimeout(r, 200))
      if (markers.length > 0) {
        map.flyToBounds(L.featureGroup(markers).getBounds().pad(0.1), { duration: 1.2, easeLinearity: 0.2, animate: true })
      }
    }
  }
  animate()
}

function navigatePhotoPrev() { if (currentPhotoIndex > 0) { currentPhotoIndex--; updatePhotoView() } }
function navigatePhotoNext() { if (currentPhotoIndex < currentPhotoItems.length - 1) { currentPhotoIndex++; updatePhotoView() } }
function navigatePrev() { if (currentSection > 0) loadSection(currentSection - 1) }
function navigateNext() { if (currentSection < totalSections - 1) loadSection(currentSection + 1) }

function updateNavButtons() {
  const prevBtn = document.getElementById('prevBtn')
  const nextBtn = document.getElementById('nextBtn')
  
  prevBtn.classList.toggle('opacity-0', currentSection === 0)
  prevBtn.classList.toggle('pointer-events-none', currentSection === 0)
  prevBtn.classList.toggle('opacity-80', currentSection !== 0)
  
  nextBtn.classList.toggle('opacity-0', currentSection === totalSections - 1)
  nextBtn.classList.toggle('pointer-events-none', currentSection === totalSections - 1)
  nextBtn.classList.toggle('opacity-80', currentSection !== totalSections - 1)
}

window.addEventListener('load', init)
window.addEventListener('resize', () => {
  const wasMobile = isMobile
  isMobile = handleLayoutSwitch()
  
  // 如果从移动端切换到桌面端，初始化地图
  if (wasMobile && !isMobile && !mapInitialized) {
    initMap()
    if (currentSection > 0) {
      const mapContainer = document.querySelector('.map-container')
      mapContainer.style.display = 'block'
      mapContainer.style.opacity = '1'
      addDayMarkers(currentSection - 1)
      if (markers.length > 0) {
        map.invalidateSize()
        map.fitBounds(L.featureGroup(markers).getBounds().pad(0.1), { animate: false })
      }
    }
  }
})
</script>


  <style is:global>
    /* GPU 加速优化 */
    #leftCard, #rightCard {
      will-change: transform, opacity;
      transform: translateZ(0);
      backface-visibility: hidden;
    }

    .card-enter-left {
      transform: translate3d(-30px, 0, 0);
      opacity: 0;
      transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .card-enter-right {
      transform: translate3d(30px, 0, 0);
      opacity: 0;
      transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .card-exit {
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .content-area {
      will-change: opacity, transform;
      transform: translateZ(0);
    }

    .content-area.fade-out {
      opacity: 0;
      transform: translate3d(0, 12px, 0);
      transition: opacity 0.25s ease-out, transform 0.25s ease-out;
    }

    .content-area.fade-in {
      opacity: 1;
      transform: translate3d(0, 0, 0);
      transition: opacity 0.4s ease-out, transform 0.4s ease-out;
    }

    #photoViewMode {
      will-change: opacity;
      transform: translateZ(0);
      transition: opacity 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    }

    #photoViewMode.active { opacity: 1; }

    #photos-container > div {
      will-change: transform;
      transform: translateZ(0);
    }

    #prevBtn, #nextBtn, #prevPhotoBtn, #nextPhotoBtn {
      will-change: transform, opacity;
      transform: translateZ(0);
    }
    
    #bottomNav {
      will-change: opacity;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    /* 滚动条隐藏 */
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    .scrollbar-hide::-webkit-scrollbar { display: none; }

    /* 玻璃态效果 */
    .glass-effect {
      background: rgba(255, 255, 255, 0.88);
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
    }

    /* Shimmer 动画 */
    .animate-shimmer {
      animation: shimmer 1.5s ease-in-out infinite;
    }

    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }

    /* 移动端布局 (pad 及以下 < 1024px) */
    @media (max-width: 1023px) {
      /* 主容器移动端布局 */
      .mobile-layout {
        display: flex;
        flex-direction: column;
        padding: 1rem;
        gap: 0;
      }
      
      /* 左侧卡片移动端样式 */
      .mobile-card {
        width: 100% !important;
        height: 100% !important;
        border-radius: 1.5rem;
      }
      
      /* 移动端首页卡片透明样式 */
      .mobile-cover-card {
        background: rgba(255, 255, 255, 0.55) !important;
        backdrop-filter: blur(8px) !important;
        -webkit-backdrop-filter: blur(8px) !important;
      }
      
      /* 内容区域移动端样式 */
      .mobile-card #contentArea {
        padding: 1.5rem !important;
        padding-top: 2rem !important;
        padding-bottom: 5rem !important;
      }
      
      /* 封面移动端样式 */
      .mobile-cover {
        text-align: center;
        padding: 1rem;
      }
      
      .mobile-cover .mobile-title {
        font-size: 2.5rem !important;
        line-height: 1.2 !important;
      }
      
      .mobile-cover .mobile-subtitle {
        font-size: 1.5rem !important;
        margin-bottom: 1.5rem !important;
      }
      
      .mobile-cover .mobile-desc {
        max-width: 100%;
        font-size: 0.9rem;
      }
      
      .mobile-cover > div:last-child {
        justify-content: center;
        margin-top: 2rem !important;
      }
      
      /* 行程日标题移动端样式 */
      .mobile-day-title {
        font-size: 1.75rem !important;
        margin-bottom: 1.5rem !important;
      }
      
      /* 照片查看模式移动端样式 */
      #photoViewMode {
        border-radius: 1.5rem;
      }
      
      #photoViewMode > div:first-child {
        padding: 1rem;
      }
      
      #photoViewMode img {
        border-radius: 1rem;
      }
      
      /* 底部导航移动端样式 */
      #bottomNav {
        bottom: 1rem;
        padding: 0.75rem;
      }
      
      #bottomNav #prevBtn,
      #bottomNav #nextBtn {
        width: 2.5rem;
        height: 2.5rem;
      }
      
      /* 照片网格移动端样式 */
      #photos-container {
        gap: 0.75rem !important;
        margin-top: 1.5rem !important;
      }
      
      #photos-container > div {
        border-radius: 0.75rem;
      }
    }

    /* 小屏手机适配 */
    @media (max-width: 480px) {
      .mobile-layout {
        padding: 0.75rem;
      }
      
      .mobile-card #contentArea {
        padding: 1rem !important;
        padding-top: 1.5rem !important;
        padding-bottom: 4.5rem !important;
      }
      
      .mobile-cover .mobile-title {
        font-size: 2rem !important;
      }
      
      .mobile-cover .mobile-subtitle {
        font-size: 1.25rem !important;
      }
      
      .mobile-day-title {
        font-size: 1.5rem !important;
      }
      
      #bottomNav {
        bottom: 0.75rem;
      }
    }
  </style>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
  <script is:inline src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
</div>
